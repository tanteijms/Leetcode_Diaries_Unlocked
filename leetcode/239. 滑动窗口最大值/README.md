# [239. 滑动窗口最大值](https://leetcode.cn/problems/sliding-window-maximum/)



## 题目

给你一个整数数组 `nums`，有一个大小为 `k` 的滑动窗口从数组的最左侧移动到数组的最右侧。你只可以看到在滑动窗口内的 `k` 个数字。滑动窗口每次只向右移动一位。

返回 *滑动窗口中的最大值* 。

 

**示例 1：**

```
输入：nums = [1,3,-1,-3,5,3,6,7], k = 3
输出：[3,3,5,5,6,7]
解释：
滑动窗口的位置                最大值
---------------               -----
[1  3  -1] -3  5  3  6  7       3
 1 [3  -1  -3] 5  3  6  7       3
 1  3 [-1  -3  5] 3  6  7       5
 1  3  -1 [-3  5  3] 6  7       5
 1  3  -1  -3 [5  3  6] 7       6
 1  3  -1  -3  5 [3  6  7]      7
```

**示例 2：**

```
输入：nums = [1], k = 1
输出：[1]
```

 

**提示：**

- $1 <= nums.length <= 10^5$
- $-10^4 <= nums[i] <= 10^4$
- `1 <= k <= nums.length`



## 题解

- 时间复杂度：O(n)。虽然是两层循环，但是看每个元素对于pop和push的操作，分别至多只有一次，因此就是2*n

- 空间复杂度：O(k)。队列k个元素

  仔细分析：由于队列中排除了相同的元素（如果有相同的，pop掉先前的，再添加新的），因此记录一个U，是nums中不重复元素的个数

  因此空间复杂度为：O(min(U, k))

```cpp
class Solution
{
public:
    vector<int> maxSlidingWindow(vector<int> &nums, int k)
    {
        vector<int> ans;
        deque<int> q;
        int n = nums.size();
        for (int i = 0; i < n; i++)
        {
            // 入
            while (!q.empty() && nums[q.back()] <= nums[i])
            {
                // =的时候也要移除，确保是最新的
                q.pop_back();
            }
            q.push_back(i); // 记录的是索引值。因为前后顺序是重要的，光记录值没有用

            // 出
            if (i - q.front() >= k) // 说明此时队头已经出了k的窗口范围了
                q.pop_front();

            // 记录答案
            if (i >= k - 1) // 一开始在k-1号元素的时候才开始记录答案
                ans.push_back(nums[q.front()]);
        }
        return ans;
    }
};
```





## points

1. 如何在当前最大值离开窗口后确定下一个max是关键

2. 维护一个单调队列，用来存储当前范围内的最大值序列，是递减的

   队头是最大值，后面的依次往里添加

   循环遍历每一个值的时候，首先判断1. 队列非空2. 当前值是否比队尾的值更大

   这里有一个原理是如果当前新的值，比队尾的更大，那么由于新的值是后来的，比队尾更晚离开窗口范围，且值还更大，这样综合来看，目前队尾的值是永远不可能成为最大值的，因此可以直接排除掉

   这里写一个循环来遍历队尾，删掉所有比当前新值更小的

   之后把当前索引值添加进队尾。注意记录的是索引值，因为窗口是不断在滑动的，因此前后顺序是重要的，单单记录一个值是没有意义的

3. 下面判断出队列的情况，因为遍历到了新的索引，就有可能需要删掉队头的值

   如果当前索引i减去队头值，也是索引，这二者之差已经>=k，即窗口值的话，说明此时窗口已经向右滑动，导致队头的索引出了窗口范围了，因此需要pop掉队头

4. 完成了新值入队列以及可能的旧值出队列，下面来记录答案值。由于维护的是一个单调队列，因此答案就是队头索引对应的数组值，加入到ans里